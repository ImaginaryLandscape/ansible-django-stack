---

- name: Include git checkout
  include: git.yml

- name: Install uwsgi into virtualenv
  pip:
    name=uwsgi
    virtualenv={{ django__virtualenv_dir }}

- name: Copy the uwsig config file
  template:
    src=uwsgi.ini.j2
    dest={{ django__uwsgi_filename }}
    owner={{ site_user }}
    group={{ shared_group }}

- name: Copy the supervisor config file for Django
  template:
    src=supervisor-django.j2
    dest=/etc/supervisor/conf.d/django.conf
    owner=root
    group=root
  notify: reread supervisord
  tags:
    - supervisor
